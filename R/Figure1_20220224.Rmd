---
title: "Figure1_20220224"
output:
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Figure1

required libraries

```{r, echo=FALSE}
library(edgeR)
library(SummarizedExperiment)
library(SEtools)
library(plgINS)
library(ggplot2)
library(DESeq2)
library(sva)
library(cowplot)
source("BioStatsfunctions_LvZ.R")
set.seed(123)
sessionInfo()
```
Load data and build SEs

```{r}
STR2d <- readRDS("../data/STR2.dHC.SE.rds")
STR2v <- readRDS("../data/STR2.vHC.SE.rds")
STR3 <- readRDS("../data/STR3.vHC.SE.rds")

STR2 <- cbind(STR2d,STR2v)
STR2$SampleNumber <- NULL
STR <- cbind(STR2,STR3)
STR$Condition2[STR$Condition2 == "Saline-Ctrl"] <- "PBS-Control"
STR$Condition2[STR$Condition2 == "Saline-Stress"] <- "PBS-Stress"
STR$Condition2 <- droplevels(STR$Condition2)
STR$Condition[STR$Condition == "Control"] <- "Homecage"
STR <- dosvacor(STR, form = ~Condition2 + Experiment + Region, form0 = ~Experiment + Region)
STR2 <- dosvacor(STR2, form = ~Condition + Injection, form0 = ~Region)


STR2 <- STR2[,order(STR2$Region,STR2$Condition2)]
STR3 <- STR3[,order(STR3$Injection,STR3$Condition,STR3$Sex)]

  
Results <- list()

mincount <- 30
```

## Figure 1: STR2 Analysis of dHC and vHC

```{r}
#dHC
STR2d$Condition2 <- droplevels(STR2d$Condition2)
STR2d <- dosvacor(STR2d,form = ~Condition2)
STR2d <- STR2d[,order(STR2d$Injection,STR2d$Condition)]

STR2d_design <- model.matrix(~STR2d$Condition2 + STR2d$SV1 + STR2d$SV2 + STR2d$SV3 + STR2d$SV4 + STR2d$SV5)

y <- DGEList(counts=assays(STR2d)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR2d_design)
#filter out genes that are low expressed
y <- y[filterByExpr(y, STR2d_design, min.count = mincount),]
STR2d_fit <- glmQLFit(y,STR2d_design)

#vHC
STR2v$Condition2 <- droplevels(STR2v$Condition2)
STR2v <- dosvacor(STR2v,form = ~Condition2)
STR2v <- STR2v[,order(STR2v$Injection,STR2v$Condition)]

STR2v_design <- model.matrix(~STR2v$Condition2 + STR2v$SV1 + STR2v$SV2 + STR2v$SV3)

y <- DGEList(counts=assays(STR2v)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR2v_design)
#filter out genes that are low expressed
y <- y[filterByExpr(y, STR2v_design, min.count = mincount),]
STR2v_fit <- glmQLFit(y,STR2v_design)
```

### Stress responsive genes (HeatMap Fig1B)

The this Figure will show all genes that are stress responsive in dHC or vHC as one single Heatmap

```{r, fig.width=6, fig.height=6}
Results[["STR2d_FullModel"]] <- glmQLFTest(STR2d_fit, colnames(STR2d_design)[2:5])
Results[["STR2v_FullModel"]] <- glmQLFTest(STR2v_fit, colnames(STR2v_design)[2:5])
Results[["STR2d_StressEffect"]] <- glmQLFTest(STR2d_fit, contrast = c(0,1,1,0,0,0,0,0,0,0))
Results[["STR2v_StressEffect"]] <- glmQLFTest(STR2v_fit, contrast = c(0,1,1,0,0,0,0,0))
Results[["STR2v_CtrlvsSwim"]] <- glmQLFTest(STR2v_fit, contrast = c(0,1,0,0,0,0,0,0))
Results[["STR2d_CtrlvsSwim"]] <- glmQLFTest(STR2d_fit, contrast = c(0,1,0,0,0,0,0,0,0,0))



#Genes that are significant in either dHC or vHC
sig_str <- union(rownames(topTags(Results[["STR2d_StressEffect"]], p = 0.05, n = Inf)),rownames(topTags(Results[["STR2v_StressEffect"]], p = 0.05, n = Inf)))
sig_sw <- union(rownames(topTags(Results[["STR2v_CtrlvsSwim"]], p = 0.05, n = Inf)),rownames(topTags(Results[["STR2d_CtrlvsSwim"]], p = 0.05, n = Inf)))
sig <- union(rownames(topTags(Results[["STR2d_FullModel"]], p = 0.05, n = Inf)),rownames(topTags(Results[["STR2v_FullModel"]], p = 0.05, n = Inf)))

Fig1B <- sehm(STR2, 
     sig_sw, 
     gaps_at = c("Region","Injection"), 
     anno_columns = c("Region","Injection","Condition"),
     sortRowsOn = which(STR2$Injection == "Propanolol" | STR2$Condition == "Homecage"),
     do.scale = T, 
     main = "Swim responsive genes", assay = "corrected",)

print(Fig1B)
```

### Contrast analysis (Yohimbine effects, Propranolol effects and Prazosin effects) (Volcanos Fig1C and FigS1A)

This Figure will show Volcanoplots for contrast analyses in dHC and vHC independently
Contrasts are shown for 

Main Figure
        - Ctrl vs Swim
        - Ctrl vs Yohimbine
        - Ctrl vs Prop
        - Ctrl vs Praz

Supplementary Figure:
        - Swim effects (Swim  vs Ctrl)
        - Swim vs Yohimbine
        - Stress (swim + yohimbine) vs Prazosine
        - Stress (swim + yohimbine) vs

```{r}
Results[["STR2v_SwimvsYohimb"]] <- glmQLFTest(STR2v_fit, contrast = c(0,-1,1,0,0,0,0,0))
Results[["STR2v_StressvsPraz"]] <- glmQLFTest(STR2v_fit, contrast = c(0,-1,-1,0,1,0,0,0))
Results[["STR2v_StressvsPropr"]] <- glmQLFTest(STR2v_fit, contrast = c(0,-1,-1,1,0,0,0,0))
Results[["STR2v_CtrlvsPropr"]] <- glmQLFTest(STR2v_fit, contrast = c(0,0,0,1,0,0,0,0))
Results[["STR2v_CtrlvsYohimb"]] <- glmQLFTest(STR2v_fit, contrast = c(0,0,1,0,0,0,0,0))
Results[["STR2v_CtrlvsPraz"]] <- glmQLFTest(STR2v_fit, contrast = c(0,0,0,0,1,0,0,0))

Results[["STR2d_SwimvsYohimb"]] <- glmQLFTest(STR2d_fit, contrast = c(0,-1,1,0,0,0,0,0,0,0))
Results[["STR2d_StressvsPraz"]] <- glmQLFTest(STR2d_fit, contrast = c(0,-1,-1,0,1,0,0,0,0,0))
Results[["STR2d_StressvsPropr"]] <- glmQLFTest(STR2d_fit, contrast = c(0,-1,-1,1,0,0,0,0,0,0))
Results[["STR2d_CtrlvsPropr"]] <- glmQLFTest(STR2d_fit, contrast = c(0,0,0,1,0,0,0,0,0,0))
Results[["STR2d_CtrlvsYohimb"]] <- glmQLFTest(STR2d_fit, contrast = c(0,0,1,0,0,0,0,0,0,0))
Results[["STR2d_CtrlvsPraz"]] <- glmQLFTest(STR2d_fit, contrast = c(0,0,0,0,1,0,0,0,0,0))
```

```{r}
VolcanovHC <- VolcanoPlotsEdgeR(Results[c("STR2v_CtrlvsSwim","STR2v_CtrlvsYohimb","STR2v_CtrlvsPropr","STR2v_CtrlvsPraz")],main = "vHC",limits = c(-5,5))
VolcanodHC <- VolcanoPlotsEdgeR(Results[c("STR2d_CtrlvsSwim","STR2d_CtrlvsYohimb","STR2d_CtrlvsPropr","STR2d_CtrlvsPraz")], main = "dHC",limits = c(-5,5))

Fig1C <- plot_grid(VolcanovHC,VolcanodHC,ncol = 1)

VolcanovHC_S <- VolcanoPlotsEdgeR(Results[c("STR2v_StressEffect","STR2v_SwimvsYohimb","STR2v_StressvsPraz","STR2v_StressvsPropr")],main = "vHC",limits = c(-5,5))
VolcanodHC_S <- VolcanoPlotsEdgeR(Results[c("STR2d_StressEffect","STR2d_SwimvsYohimb","STR2d_StressvsPraz","STR2d_StressvsPropr")], main = "dHC",limits = c(-5,5))

FigS1A <- plot_grid(VolcanovHC_S,VolcanodHC_S,ncol = 1)
```

### Propranolol Responsive Genes (Heatmap Fig1D)

This figure shows a heatmap of all genes that have a significant stress vs stress + propranolo difference in vHC or dHC

```{r}
#Here we produce a combined heatmap of genes with significant interaction, either in vHC or dHC
sig_int <- unique(rownames(topTags(Results[["STR2d_StressvsPropr"]],p = 0.05, n = Inf)),rownames(topTags(Results[["STR2v_StressvsPropr"]],p = 0.05, n = Inf)))
rowData(STR2)$Sig_vHC <- FALSE
rowData(STR2)$Sig_vHC[match(rownames(topTags(Results[["STR2v_StressvsPropr"]],p = 0.05, n = Inf)),rownames(STR2))] <- TRUE
rowData(STR2)$Sig_dHC <- FALSE
rowData(STR2)$Sig_dHC[match(rownames(topTags(Results[["STR2d_StressvsPropr"]],p = 0.05, n = Inf)),rownames(STR2))] <- TRUE

Fig1D <- sehm(STR2, 
     sig_int, 
     gaps_at = c("Region","Injection"), 
     anno_columns = c("Region","Injection","Condition"),
     anno_rows = c("Sig_vHC","Sig_dHC"),
     do.scale = T, 
     cluster_rows = T,
     main = "Significant Propranolol effects", assay = "corrected")
```

### Propranolol response strength vHC vs dHC (Fig1E)

This figure shows the strength of the stress vs stress + propranolol in vHC vs dHC

```{r}
vHC <- Results[["STR2v_StressvsPropr"]]$table
dHC <- Results[["STR2d_StressvsPropr"]]$table

df <- data.frame(gene = sig_int ,vHC = vHC[sig_int,"logFC"], dHC = dHC[sig_int,"logFC"])
df <- df[order(df$vHC),]
df$index <- 1:nrow(df)

Fig1E <- ggplot() + geom_point(data = df,aes(index, vHC), color = "blue") + geom_point(data = df,aes(index, dHC), color = "red") + scale_y_continuous(limits = c(-3,3)) + theme_bw() + ylab("logFC")
```


### Ctrl-swim vs ctrl-swim+praz strength (FigS1B)

This Figure shows the stength of the stress effect vs the stress + prazosin effect (combined hemispheres)


```{r}
vHC_sw <- Results[["STR2v_CtrlvsSwim"]]$table
dHC_sw <- Results[["STR2d_CtrlvsSwim"]]$table
vHC_swpra <- Results[["STR2v_CtrlvsPraz"]]$table
dHC_swpra <- Results[["STR2d_CtrlvsPraz"]]$table

#select genes that are expressed in all comparisons
temp <- intersect(intersect(rownames(vHC_sw),rownames(dHC_sw)),intersect(rownames(vHC_swpra),rownames(dHC_swpra)))

sw <- vHC_sw[temp,]
sw$logFC <- (sw$logFC + dHC_sw[temp,"logFC"]) / 2

sw_pra <- vHC_swpra[temp,]
sw_pra$logFC <- (sw_pra$logFC + dHC_swpra[temp,"logFC"]) / 2

df_swvswpra <- data.frame(sw = sw$logFC,sw_pra = sw_pra$logFC)
rownames(df_swvswpra) <- rownames(sw_pra)
df_swvswpra <- na.omit(df_swvswpra[sig_sw,])
df_swvswpra <- df_swvswpra[order(df_swvswpra$sw),]
df_swvswpra$index <- 1:nrow(df_swvswpra)

FigS1B <- ggplot() + geom_point(data = df_swvswpra,aes(index, sw), color = "blue") + geom_point(data = df_swvswpra,aes(index, sw_pra), color = "red") + theme_bw() + ylab("logFC") + scale_y_continuous(limits = c(-3,3)) 

```


### Ctrl-swim vs ctrl-swim+prop strength (FigS1C)

This Figure shows the stength of the stress effect vs the stress + propranolol effect (combined hemispheres)

```{r}
vHC_sw <- Results[["STR2v_CtrlvsSwim"]]$table
dHC_sw <- Results[["STR2d_CtrlvsSwim"]]$table
vHC_swpro <- Results[["STR2v_CtrlvsPropr"]]$table
dHC_swpro <- Results[["STR2d_CtrlvsPropr"]]$table

#select genes that are expressed in all comparisons
temp <- intersect(intersect(rownames(vHC_sw),rownames(dHC_sw)),intersect(rownames(vHC_swpro),rownames(dHC_swpro)))

sw <- vHC_sw[temp,]
sw$logFC <- (sw$logFC + dHC_sw[temp,"logFC"]) / 2

sw_pro <- vHC_swpro[temp,]
sw_pro$logFC <- (sw_pro$logFC + dHC_swpro[temp,"logFC"]) / 2

df_swvswpro <- data.frame(sw = sw$logFC,sw_pro = sw_pro$logFC)
rownames(df_swvswpro) <- rownames(sw_pro)
df_swvswpro <- na.omit(df_swvswpro[sig_sw,])
df_swvswpro <- df_swvswpro[order(df_swvswpro$sw),]
df_swvswpro$index <- 1:nrow(df_swvswpro)

FigS1C <- ggplot() + geom_point(data = df_swvswpro,aes(index, sw), color = "blue") + geom_point(data = df_swvswpro,aes(index, sw_pro), color = "red") + theme_bw() + ylab("logFC") + scale_y_continuous(limits = c(-3,3)) 

```

### Ctrl-swim vs ctrl- yohimbine strength (FigS1D)

This Figure shows the stength of the stress effect vs the yohimbine effect (combined hemispheres)


```{r}
vHC_sw <- Results[["STR2v_CtrlvsSwim"]]$table
dHC_sw <- Results[["STR2d_CtrlvsSwim"]]$table
vHC_yoh <- Results[["STR2v_CtrlvsYohimb"]]$table
dHC_yoh <- Results[["STR2d_CtrlvsYohimb"]]$table

#select genes that are expressed in all comparisons
temp <- intersect(intersect(rownames(vHC_sw),rownames(dHC_sw)),intersect(rownames(vHC_yoh),rownames(dHC_yoh)))

sw <- vHC_sw[temp,]
sw$logFC <- (sw$logFC + dHC_sw[temp,"logFC"]) / 2

yoh <- vHC_yoh[temp,]
yoh$logFC <- (yoh$logFC + dHC_yoh[temp,"logFC"]) / 2

df_swvsyoh <- data.frame(sw = sw$logFC,yoh = yoh$logFC)
rownames(df_swvsyoh) <- rownames(yoh)
df_swvsyoh <- na.omit(df_swvsyoh[sig_sw,])
df_swvsyoh <- df_swvsyoh[order(df_swvsyoh$sw),]
df_swvsyoh$index <- 1:nrow(df_swvsyoh)

FigS1D <- ggplot() + geom_point(data = df_swvsyoh,aes(index, sw), color = "blue") + geom_point(data = df_swvsyoh,aes(index, yoh), color = "red") + theme_bw() + ylab("logFC") + scale_y_continuous(limits = c(-3,3)) 

```

### Sotolol Experiment Heatmap (Fig1F)

This figure shows genes that are stress responsive, but also have a significant interaction with propranolol (p adj for stress effect, p-value for interaction)

```{r}
STR3 <- dosvacor(STR3, form = ~Condition * Injection)


STR3_design <- model.matrix(~STR3$Condition * STR3$Injection + STR3$SV1 + STR3$SV2 + STR3$SV3)

y <- DGEList(counts=assays(STR3)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR3_design)
#filter out genes that are low expressed
y <- y[filterByExpr(y, STR3_design, min.count = mincount),]
STR3_fit <- glmQLFit(y,STR3_design)

Results[["STR3_FullModel"]] <- glmQLFTest(STR3_fit, colnames(STR3_design)[c(2:4,8,9)])
Results[["STR3_SwimEffect"]] <- glmQLFTest(STR3_fit, colnames(STR3_design)[2])
Results[["STR3_InteractionPropranolol"]] <- glmQLFTest(STR3_fit, colnames(STR3_design)[8])
Results[["STR3_InteractionSotolol"]] <- glmQLFTest(STR3_fit, colnames(STR3_design)[9])

sig_str3 <- rownames(topTags(Results[["STR3_FullModel"]],p = 0.05, n = Inf))
sig_str3_str <- rownames(topTags(Results[["STR3_SwimEffect"]],p = 0.05, n = Inf))

#Sig propranolol interaction
prop <- Results[["STR3_InteractionPropranolol"]]$table
prop <- prop[sig_str3_str,]
prop <- prop[prop$PValue < 0.05,]

Fig1F <- sehm(STR3, 
     rownames(prop),
     gaps_at = "Injection",
     anno_columns = c("Injection","Condition","Sex"),
     do.scale = T, 
     cluster_rows = T,
     main = "Genes with Propranolol:Swim interaction", assay = "corrected",)
```

### Sotolol Experiment female vs male (Fig1G)

This Figure shows the strenght of the stress:propranolol interaction in males vs females

```{r}
STR3_m <- STR3[,STR3$Sex == "male"]
STR3_f <- STR3[,STR3$Sex == "female"]

#males
STR3_design_m <- model.matrix(~STR3_m$Condition * STR3_m$Injection + STR3_m$SV1 + STR3_m$SV2 + STR3_m$SV3)

y <- DGEList(counts=assays(STR3_m)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR3_design_m)
STR3_m_fit <- glmQLFit(y,STR3_design_m)

Results[["STR3_m_InteractionPropranolol"]] <- glmQLFTest(STR3_m_fit, colnames(STR3_design_m)[8])

#females
STR3_design_f <- model.matrix(~STR3_f$Condition * STR3_f$Injection + STR3_f$SV1 + STR3_f$SV2 + STR3_f$SV3)

y <- DGEList(counts=assays(STR3_f)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR3_design_f)
STR3_f_fit <- glmQLFit(y,STR3_design_f)

Results[["STR3_f_InteractionPropranolol"]] <- glmQLFTest(STR3_f_fit, colnames(STR3_design_f)[8])

df2 <- data.frame(name = rownames(prop), 
                            logFC.males = Results[["STR3_m_InteractionPropranolol"]]$table[rownames(prop),"logFC"], 
                            logFC.females = Results[["STR3_f_InteractionPropranolol"]]$table[rownames(prop),"logFC"])

df2 <- df2[order(df2$logFC.males),]
df2$index <- 1:nrow(df2)

Fig1G <- ggplot() + 
  geom_point(data = df2,aes(index, logFC.males), color = "blue") + 
  geom_point(data = df2,aes(index, logFC.females), color = "red") + 
  theme_bw() + 
  ylab("logFC")
```

### Propranolol Genes of STR2 in STR2+STR3 (Figure S1E)

Heatmap that shows the significant propranolol genes of STR2 in combined data of STR2 and STR3

```{r}
STR$Injection[STR$Injection == "Propanolol"] <- "Propranolol"
STR$Injection[STR$Injection == "Saline"] <- "PBS"
STR$Injection <- factor(STR$Injection, levels = c("PBS","Yohimbine","Propranolol","Prazosin","Sotalol"))
STR$Injection[STR$Condition2 == "Saline-Yohimbine"] <- "Yohimbine"
STR$Sex[STR$Sex == "Male"] <- "male"
STR <- STR[,order(STR$Experiment, STR$Region, STR$Injection, STR$Condition, STR$Sex)]
FigS1E <- sehm(STR, 
     sig_int,
     gaps_at = c("Experiment","Region"),
     anno_columns = c("Experiment","Injection","Condition","Sex"),
     do.scale = T, 
     cluster_rows = T,
     main = "Genes with Propranolol:Swim interaction", assay = "corrected",)
```

### Expression of Dio2 (Figure S1F)

```{r}
plotdat <- meltSE(STR,c("Dio2"))
 
FigS1F <- ggplot(plotdat, aes(Injection, corrected, color = Condition)) + 
  geom_boxplot(outlier.shape = NA) + 
  geom_point(position = position_jitterdodge()) + 
  facet_grid(feature~Region +Experiment, scales = "free") + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


### Response strength STR3 (swim vs propranolol vs sotalol) (Figure S1G)

This figure shows the stress responsive genes with significant stress:propranolol interaction and their respective effect strength in PBS, Propranolol and Sotalol control vs swim comparisons

```{r}
STR3_contrasts <- dosvacor(STR3, form = ~Condition2)
STR3_contrasts_design <- model.matrix(~STR3$Condition2 + STR3$SV1 + STR3$SV2 + STR3$SV3)

y <- DGEList(counts=assays(STR3_contrasts)$counts)
y <- calcNormFactors(y)
y <- estimateDisp(y,STR3_contrasts_design)
#filter out genes that are low expressed
y <- y[filterByExpr(y, STR3_contrasts_design, min.count = mincount),]
STR3_contrasts_fit <- glmQLFit(y,STR3_contrasts_design)

Results[["STR3_contrasts_PBS_CtrlvsSwim"]] <- glmQLFTest(STR3_contrasts_fit, contrast = c(0,1,0,0,0,0,0,0,0))
Results[["STR3_contrasts_Propranolol_CtrlvsSwim"]] <- glmQLFTest(STR3_contrasts_fit, contrast = c(0,0,-1,1,0,0,0,0,0))
Results[["STR3_contrasts_Sotalol_CtrlvsSwim"]] <- glmQLFTest(STR3_contrasts_fit, contrast = c(0,0,0,0,-1,1,0,0,0))

df_STR3_contrasts <- data.frame(PBS = Results[["STR3_contrasts_PBS_CtrlvsSwim"]]$table$logFC,
                                Prop = Results[["STR3_contrasts_Propranolol_CtrlvsSwim"]]$table$logFC,
                                Sot = Results[["STR3_contrasts_Sotalol_CtrlvsSwim"]]$table$logFC)
rownames(df_STR3_contrasts) <- rownames(Results[["STR3_contrasts_PBS_CtrlvsSwim"]]$table)

df_STR3_contrasts <- df_STR3_contrasts[rownames(prop),]
df_STR3_contrasts <- df_STR3_contrasts[order(df_STR3_contrasts$PBS),]
df_STR3_contrasts$index <- 1:nrow(df_STR3_contrasts)

Fig1G <- ggplot() + 
  geom_point(data = df_STR3_contrasts,aes(index, PBS), color = "blue") + 
  geom_point(data = df_STR3_contrasts,aes(index, Prop), color = "red") + 
  geom_point(data = df_STR3_contrasts,aes(index, Sot), color = "green2") + 
  theme_bw() + 
  ylab("logFC")

```


## Show Final Figures

```{r, fig.width=6, fig.height=6}
print(Fig1B)
```
```{r, fig.width=6, fig.height=6}
print(Fig1C)
```

```{r, fig.width=6, fig.height=6}
print(FigS1A)
```

```{r, fig.width=4, fig.height=4}
print(FigS1B)
```

```{r, fig.width=4, fig.height=4}
print(FigS1C)
```

```{r, fig.width=4, fig.height=4}
print(FigS1D)
```

```{r, fig.width=6, fig.height=5}
print(Fig1D)
```

```{r, fig.width=4, fig.height=4}
print(Fig1E)
```

```{r, fig.width=6, fig.height=6}
print(Fig1F)
```

```{r, fig.width=4, fig.height=4}
print(Fig1G)
```

```{r, fig.width=6, fig.height=4}
print(FigS1E)
```

```{r, fig.width=6, fig.height=3}
print(FigS1F)
```

```{r, fig.width=4, fig.height=4}
print(Fig1G)
```

## Export Figures

```{r}
pdf(file = "../Figures/Fig1B.pdf", width = 6, height = 6)
print(Fig1B)
dev.off()

pdf(file = "../Figures/Fig1C.pdf", width = 6, height = 6)
print(Fig1C)
dev.off()

pdf(file = "../Figures/FigS1A.pdf", width = 6, height = 6)
print(FigS1A)
dev.off()

pdf(file = "../Figures/FigS1B.pdf", width = 4, height = 4)
print(FigS1B)
dev.off()

pdf(file = "../Figures/FigS1C.pdf", width = 4, height = 4)
print(FigS1C)
dev.off()

pdf(file = "../Figures/FigS1D.pdf", width = 4, height = 4)
print(FigS1D)
dev.off()

pdf(file = "../Figures/Fig1D.pdf", width = 6, height = 5)
print(Fig1D)
dev.off()

pdf(file = "../Figures/Fig1E.pdf", width = 4, height = 4)
print(Fig1E)
dev.off()

pdf(file = "../Figures/Fig1F.pdf", width = 6, height = 6)
print(Fig1F)
dev.off()

pdf(file = "../Figures/Fig1G.pdf", width = 4, height = 4)
print(Fig1G)
dev.off()

pdf(file = "../Figures/FigS1E.pdf", width = 6, height = 4)
print(FigS1E)
dev.off()

pdf(file = "../Figures/FigS1F.pdf", width = 6, height = 3)
print(FigS1F)
dev.off()

pdf(file = "../Figures/Fig1G.pdf", width = 4, height = 4)
print(Fig1G)
dev.off()
```

## Create final data frames (containing corrected expression and Results data as single SE file)

```{r}
rowData(STR2)$Sig_vHC <- NULL
rowData(STR2)$Sig_dHC <- NULL
rowData(STR2)[["STR2v_FullModel"]] <- Results$STR2v_FullModel$table[rownames(STR2),]
rowData(STR2)[["STR2d_FullModel"]] <- Results$STR2d_FullModel$table[rownames(STR2),]
rowData(STR2)[["STR2d_StressEffect"]] <- Results$STR2d_StressEffect$table[rownames(STR2),]
rowData(STR2)[["STR2v_StressEffect"]] <- Results$STR2v_StressEffect$table[rownames(STR2),]
rowData(STR2)[["STR2v_CtrlvsSwim"]] <- Results$STR2v_CtrlvsSwim$table[rownames(STR2),]
rowData(STR2)[["STR2d_CtrlvsSwim"]] <- Results$STR2d_CtrlvsSwim$table[rownames(STR2),]
rowData(STR2)[["STR2v_SwimvsYohimb"]] <- Results$STR2v_SwimvsYohimb$table[rownames(STR2),]
rowData(STR2)[["STR2v_StressvsPraz"]] <- Results$STR2v_StressvsPraz$table[rownames(STR2),]
rowData(STR2)[["STR2v_StressvsPropr"]] <- Results$STR2v_StressvsPropr$table[rownames(STR2),]
rowData(STR2)[["STR2v_CtrlvsPropr"]] <- Results$STR2v_CtrlvsPropr$table[rownames(STR2),]
rowData(STR2)[["STR2v_CtrlvsYohimb"]] <- Results$STR2v_CtrlvsYohimb$table[rownames(STR2),]
rowData(STR2)[["STR2v_CtrlvsPraz"]] <- Results$STR2v_CtrlvsPraz$table[rownames(STR2),]
rowData(STR2)[["STR2d_SwimvsYohimb"]] <- Results$STR2d_SwimvsYohimb$table[rownames(STR2),]
rowData(STR2)[["STR2d_StressvsPraz"]] <- Results$STR2d_StressvsPraz$table[rownames(STR2),]
rowData(STR2)[["STR2d_StressvsPropr"]] <- Results$STR2d_StressvsPropr$table[rownames(STR2),]
rowData(STR2)[["STR2d_CtrlvsPropr"]] <- Results$STR2d_CtrlvsPropr$table[rownames(STR2),]
rowData(STR2)[["STR2d_CtrlvsYohimb"]] <- Results$STR2d_CtrlvsYohimb$table[rownames(STR2),]
rowData(STR2)[["STR2d_CtrlvsPraz"]] <- Results$STR2d_CtrlvsPraz$table[rownames(STR2),]

saveRDS(STR2,"../final_data/STR2_Complete.SE.Rds")

rowData(STR3)[["STR3_FullModel"]] <- Results$STR3_FullModel$table[rownames(STR3),]
rowData(STR3)[["STR3_SwimEffect"]] <- Results$STR3_SwimEffect$table[rownames(STR3),]
rowData(STR3)[["STR3_InteractionPropranolol"]] <- Results$STR3_InteractionPropranolol$table[rownames(STR3),]
rowData(STR3)[["STR3_InteractionSotolol"]] <- Results$STR3_InteractionSotolol$table[rownames(STR3),]
rowData(STR3)[["STR3_m_InteractionPropranolol"]] <- Results$STR3_m_InteractionPropranolol$table[rownames(STR3),]
rowData(STR3)[["STR3_f_InteractionPropranolol"]] <- Results$STR3_f_InteractionPropranolol$table[rownames(STR3),]
rowData(STR3)[["STR3_contrasts_PBS_CtrlvsSwim"]] <- Results$STR3_contrasts_PBS_CtrlvsSwim$table[rownames(STR3),]
rowData(STR3)[["STR3_contrasts_Propranolol_CtrlvsSwim"]] <- Results$STR3_contrasts_Propranolol_CtrlvsSwim$table[rownames(STR3),]
rowData(STR3)[["STR3_contrasts_Sotalol_CtrlvsSwim"]] <- Results$STR3_contrasts_Sotalol_CtrlvsSwim$table[rownames(STR3),]

saveRDS(STR3,"../final_data/STR3_Complete.SE.Rds")

```
